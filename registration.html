<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Register - Auth App</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <main class="card" aria-labelledby="reg-title">
      <div class="header">
        <div class="logo" aria-hidden></div>
        <div>
          <div id="reg-title" class="title">Create your account</div>
          <div class="subtitle">Secure sign up â€” Glassmorphism UI</div>
        </div>
      </div>

  <form id="regForm" class="form" novalidate>
        <div class="row">
          <div class="input">
            <label for="name">Name</label>
            <input id="name" name="name" type="text" required />
            <div class="helper error" id="nameError"></div>
          </div>
          <div class="input">
            <label for="dob">DOB</label>
            <input id="dob" name="dob" type="date" required />
            <div class="helper error" id="dobError"></div>
          </div>
        </div>

        <div class="input">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required />
          <div class="helper error" id="emailError"></div>
        </div>

        <div class="row">
          <div class="input">
            <label for="phone">Phone</label>
            <input id="phone" name="phone" type="tel" inputmode="numeric" pattern="[0-9]*" required />
            <div class="helper error" id="phoneError"></div>
          </div>
          <div class="input">
            <label for="pass">Password</label>
            <input id="pass" name="pass" type="password" required />
            <div class="helper error" id="passError"></div>
          </div>
        </div>

        <div class="input">
          <label for="confirm">Confirm Password</label>
          <input id="confirm" name="confirm" type="password" required />
          <div class="helper error" id="confirmError"></div>
        </div>

  <button type="submit" class="btn">Register</button>
  <div id="regGeneral" class="note" style="margin-top:8px"></div>

  <div class="footer">Already have an account? <a class="link" href="login.html">Login</a></div>
      </form>
    </main>
  </div>

<script>
// Registration logic with strict password rules
(function(){
  const form = document.getElementById('regForm');
  const nameEl = document.getElementById('name');
  const emailEl = document.getElementById('email');
  const passEl = document.getElementById('pass');
  const confirmEl = document.getElementById('confirm');
  const dobEl = document.getElementById('dob');
  const phoneEl = document.getElementById('phone');

  function showError(id,msg){
    document.getElementById(id).textContent = msg || '';
  }

  function validateEmail(email){
    // basic RFC-like check
    return /^\S+@\S+\.\S+$/.test(email);
  }

  function validatePassword(p){
    // Return an object with ok + message to explain failures
    const out = { ok: false, message: null };
    if(typeof p !== 'string') { out.message = 'Invalid password format'; return out; }
    if(p.length < 1 || p.length > 8) { out.message = 'Password length must be between 1 and 8 characters'; return out; }
    if(!/[A-Z]/.test(p)) { out.message = 'Password must include at least one uppercase letter'; return out; }
    if(!/[a-z]/.test(p)) { out.message = 'Password must include at least one lowercase letter'; return out; }
    if(!/[^A-Za-z0-9]/.test(p)) { out.message = 'Password must include at least one special character'; return out; }
    out.ok = true; return out;
  }

  function getUsers(){
    try{
      return JSON.parse(localStorage.getItem('users')||'[]');
    }catch(e){return []}
  }

  function saveUser(user){
    const users = getUsers();
    users.push(user);
    localStorage.setItem('users', JSON.stringify(users));
  }

  form.addEventListener('submit', function(e){
    e.preventDefault();
    console.debug('Registration submit clicked');
    // clear errors
    ['nameError','emailError','passError','confirmError','phoneError','dobError'].forEach(id=>showError(id,''));
    document.getElementById('regGeneral').textContent = '';

    let valid=true;
    const name = nameEl.value.trim();
    const email = emailEl.value.trim().toLowerCase();
  // Trim leading/trailing whitespace from password fields to avoid accidental spaces
  const pass = passEl.value.trim();
  const confirm = confirmEl.value.trim();
    const dob = dobEl.value;
    const phone = phoneEl.value.trim();

    console.debug({name,email,pass,confirm,dob,phone});

    if(!name){ showError('nameError','Please enter your name'); valid=false; }
    if(!dob){ showError('dobError','Please provide your date of birth'); valid=false; }

    if(!validateEmail(email)){ showError('emailError','Enter a valid email'); valid=false; }

    if(!/^\d+$/.test(phone)){ showError('phoneError','Phone must be numbers only'); valid=false; }

  const passCheck = validatePassword(pass);
  if(!passCheck.ok){ showError('passError', passCheck.message); valid=false; }

    if(pass !== confirm){ showError('confirmError','Passwords do not match'); valid=false; }

    if(!valid){
      document.getElementById('regGeneral').textContent = 'Please fix the errors above and try again.';
      console.debug('Validation failed');
      return;
    }

    // Prevent duplicate email
    const users = getUsers();
    if(users.some(u=>u.email === email)){
      showError('emailError','An account with this email already exists');
      document.getElementById('regGeneral').textContent = 'Duplicate email - please login or use another email.';
      console.debug('Duplicate email for', email);
      return;
    }

    const user = { name, email, password: pass, dob, phone };
    saveUser(user);
    console.debug('User saved', user);
    // Redirect to login page
    location.href = 'login.html';
  });
})();
</script>
</body>
</html>
